<!-- CONTENEDOR -->
<div
  class="w-full"
  [ngClass]="{
    'flex justify-end': author === 'user',
    'flex justify-start': author === 'system',
    'block': author === 'ai'
  }"
>
  <!-- BURBUJA -->
  <div
    class="rounded-2xl px-4 py-3 text-sm leading-relaxed"
    [ngClass]="{
      'max-w-[85%] bg-primary text-primary-foreground rounded-br-none': author === 'user',
      'max-w-[85%] bg-background text-text-main rounded-bl-none border border-border': author === 'system',
      'w-full bg-background text-text-main border border-border': author === 'ai'
    }"
  >
    <!-- HEADER -->
    <div class="mb-1 text-xs opacity-70 font-semibold select-none">
      @if (author === 'user') { TÃº }
      @if (author === 'system') { Speaker 1 }
      @if (author === 'ai') { Generando respuesta IA: }
    </div>

    <!-- TEXTO -->
    <div class="whitespace-pre-wrap break-words">
      {{ message.text }}
    </div>

    <!-- ACCIONES -->
    <div class="mt-2 flex items-center gap-3">
      <button type="button" class="opacity-40 hover:opacity-100 hover:text-white transition-all cursor-pointer" title="Copiar" (click)="onCopy()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
          <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
        </svg>
      </button>

      @if (author === 'system') {
        <button type="button" class="opacity-40 hover:opacity-100 hover:text-white transition-all cursor-pointer" title="Generar" (click)="onGenerate()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z"/>
            <path d="M20 2v4"/><path d="M22 4h-4"/><circle cx="4" cy="20" r="2"/>
          </svg>
        </button>

        <button type="button" class="opacity-40 hover:opacity-100 hover:text-white transition-all cursor-pointer" title="Traducir" (click)="onTranslate()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="m5 8 6 6"/><path d="m4 14 6-6 2-3"/><path d="M2 5h12"/><path d="M7 2h1"/>
            <path d="m22 22-5-10-5 10"/><path d="M14 18h6"/>
          </svg>
        </button>
      }

      @if (author === 'ai') {
        <button type="button" class="opacity-40 hover:opacity-100 hover:text-white transition-all cursor-pointer" title="Enviar al teleprompter" (click)="onForward()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="m15 17 5-5-5-5"/><path d="M4 18v-2a4 4 0 0 1 4-4h12"/>
          </svg>
        </button>
      }

      <button type="button" class="opacity-40 hover:opacity-100 hover:text-white transition-all cursor-pointer" title="Favorito" (click)="onStar()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
             [attr.fill]="message.favorite ? 'currentColor' : 'none'"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z"/>
        </svg>
      </button>
    </div>
  </div>
</div>
